#!/usr/bin/env bash
# runs nginx as nginx user

# Update the package index
apt-get update

# Install net-tools if not already installed
apt-get install -y net-tools

# Modify nginx user and group in configuration files
sed -i 's/user\s*www-data;/user nginx;/g' /etc/nginx/nginx.conf
sed -i 's/www-data/nginx/g' /etc/nginx/nginx.conf
sed -i 's/www-data/nginx/g' /etc/nginx/sites-available/default

# Modify nginx port to 8080 in default site configuration
sed -i 's/listen\s*80;/listen 8080;/g' /etc/nginx/sites-available/default

# Start the nginx service
service nginx start

# Check if nginx is running as the nginx user
if ps auxff | grep -q '[n]ginx'; then
  echo "Nginx is running as nginx user"
else
  echo "Nginx is NOT running as nginx user"
fi

# Check if nginx is listening on port 8080
if nc -z 0 8080; then
  echo "Nginx is listening on port 8080"
else
  echo "Nginx is NOT listening on port 8080"
fi

